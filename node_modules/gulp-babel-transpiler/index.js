var babel = require('babel-core');
var Stream = require("stream");
var path = require("path");

function babelTranspile(params) {
	"use strict";

	var stream = new Stream.Transform({objectMode: true});

	stream._transform = function(file, enc, callback) {

		var fileName = path.basename(file.history);

		var buffer = new Buffer(babel.transform(file.contents+'').code, enc);// потоки поддерживают только буфер, "" и null
		file.contents = buffer;

		file.path = path.join(file.base, fileName.replace('es6', 'es5'));
		callback(null, file);
		
	}

	return stream;
};

module.exports = babelTranspile;